syntax = "proto3";

package eventstore.connectors;

import "google/api/annotations.proto";
import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "protocol.proto";
import "managementplane/resources.proto";

option csharp_namespace = "EventStore.Connectors.Management.Contracts.Commands";

service ConnectorCommandService {
  rpc Create(CreateConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/create",
      body: "*"
    };
  }

  rpc Reconfigure(ReconfigureConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/reconfigure",
      body: "*"
    };
  }

  rpc Delete(DeleteConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/delete",
      body: "*"
    };
  }
  
  rpc Start(StartConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/start",
      body: "*"
    };
  }

  rpc Stop(StopConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/stop",
      body: "*"
    };
  }

  rpc Reset(ResetConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/reset",
      body: "*"
    };
  }

  rpc Rename(RenameConnector) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/rename",
      body: "*"
    };
  }

  rpc RecordStateChange(RecordConnectorStateChange) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/record-state-change",
      body: "*"
    };
  }

  rpc RecordPositions(RecordConnectorPositions) returns (CommandResult) {
    option (google.api.http) = {
      post: "/v1/connectors/record-positions",
      body: "*"
    };
  }
}

message CreateConnector {
  string              connector_id = 1;
  string              name = 2;
  map<string, string> settings = 3;  // everything else even if it could come from the settings.
}

message ReconfigureConnector {
  string                                   connector_id = 1;
  map<string, google.protobuf.StringValue> settings = 2;
}

message DeleteConnector {
  string connector_id = 1;
}

message StartConnector {
  string connector_id = 1;
}

message StopConnector {
  string connector_id = 1;
}

message ResetConnector {
  string                  connector_id = 1;
  repeated RecordPosition positions = 2;  // optional, if not provided, reset to the config default earliest/latest
}

message RenameConnector {
  string connector_id = 1;
  string name = 2;
}

message RecordConnectorStateChange {
  string                    connector_id = 1;
  ConnectorState            from_state = 2;
  ConnectorState            to_state = 3;
  Error                     error_details = 4;
  google.protobuf.Timestamp timestamp = 5;
}

message RecordConnectorPositions {
  string                    connector_id = 1;
  repeated RecordPosition   positions = 2;
  google.protobuf.Timestamp timestamp = 3;
}